/api/auth/oauth/{provider}:
  get:
    tags:
      - Authentication
    summary: Initiate OAuth authentication
    description: |
      Get OAuth authorization URL to redirect user for authentication.
      Supports providers like Google, Microsoft, GitHub, and custom OAuth providers.
    operationId: getOAuthAuthorizationURL
    security: []
    parameters:
      - name: provider
        in: path
        required: true
        schema:
          type: string
          enum: [google, microsoft, github, custom]
        description: OAuth provider name
        example: "google"
    responses:
      '200':
        description: OAuth authorization URL generated
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/OAuthAuthResponse'
            example:
              authorization_url: "https://accounts.google.com/o/oauth2/v2/auth?client_id=123&redirect_uri=https://api.example.com/api/auth/oauth/callback&response_type=code&scope=openid%20email%20profile&state=random_csrf_token"
              state: "random_csrf_token"
      '400':
        $ref: '../openapi.yaml#/components/responses/ValidationError'
      '404':
        description: OAuth provider not configured
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/Error'
            example:
              error: "OAuth provider not configured"
              code: "PROVIDER_NOT_FOUND"

/api/auth/oauth/callback:
  post:
    tags:
      - Authentication
    summary: Handle OAuth callback
    description: |
      Process OAuth callback after user authorizes the application.
      Exchanges authorization code for tokens and creates/logs in user.
    operationId: handleOAuthCallback
    security: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../openapi.yaml#/components/schemas/OAuthCallbackRequest'
          example:
            provider: "google"
            code: "4/0AX4XfWh..."
            state: "random_csrf_token"
    responses:
      '200':
        description: OAuth authentication successful
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/OAuthCallbackResponse'
            example:
              access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              refresh_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              user:
                id: "550e8400-e29b-41d4-a716-446655440000"
                email: "user@example.com"
                first_name: "John"
                last_name: "Doe"
                phone: "+1234567890"
                roles: ["user"]
                is_active: true
                created_at: "2024-01-15T10:30:00Z"
                updated_at: "2024-01-15T10:30:00Z"
              is_new_user: false
      '400':
        $ref: '../openapi.yaml#/components/responses/ValidationError'
      '401':
        description: OAuth authentication failed
        content:
          application/json:
            schema:
              $ref: '../openapi.yaml#/components/schemas/Error'
            example:
              error: "Invalid authorization code or state mismatch"
              code: "OAUTH_FAILED"
      '429':
        $ref: '../openapi.yaml#/components/responses/RateLimitError'
